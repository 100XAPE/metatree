generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Token {
  id            String   @id @default(uuid())
  mint          String   @unique
  name          String
  symbol        String
  imageUrl      String?
  marketCap     Float    @default(0)
  price         Float    @default(0)
  volume5m      Float    @default(0)
  volume24h     Float    @default(0)
  priceChange5m Float    @default(0)
  heatScore     Float    @default(0)
  isVisible     Boolean  @default(false)
  isMainRunner  Boolean  @default(false)
  phase         String   @default("PUMP_FUN")
  keywords      String[] @default([])
  
  // Tree structure - links derivative tokens to their parent runner
  parentRunnerId String?
  parentRunner   Token?  @relation("TokenDerivatives", fields: [parentRunnerId], references: [id])
  derivatives    Token[] @relation("TokenDerivatives")
  matchReason    String? // Why this token was matched as a derivative
  
  // Social links
  website        String?
  twitter        String?
  telegram       String?
  
  // Legacy narrative support
  narrativeId   String?
  narrative     Narrative? @relation(fields: [narrativeId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Narrative {
  id             String   @id @default(uuid())
  name           String
  customName     String?
  keywords       String[]
  totalMarketCap Float    @default(0)
  tokenCount     Int      @default(0)
  tokens         Token[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Settings {
  id                 String  @id @default("global")
  minVolume5m        Float   @default(500)
  mainRunnerMinMc    Float   @default(500000)
  telegramChatId     String?
  telegramBotToken   String?
  
  // Runner criteria
  runnerMinMc        Float   @default(1000000)    // $1M
  runnerMaxMc        Float   @default(1000000000) // $1B
  runnerMinVol24h    Float   @default(500000)     // $500K
  runnerMinVol5m     Float   @default(50000)      // $50K
  runnerMinAgeMinutes Int    @default(5)          // 5 mins
  runnerMaxAgeDays   Int     @default(7)          // 7 days
  runnerMinHolders   Int     @default(50)
  runnerMinLiquidity Float   @default(10000)      // $10K
  
  // Phase filters
  runnerIncludeGraduated Boolean @default(true)
  runnerIncludeRaydium   Boolean @default(true)
  runnerIncludePumpFun   Boolean @default(false)
  runnerIncludeNew       Boolean @default(false)
  
  // Exclusions
  excludeStablecoins  Boolean @default(true)
  excludeWrapped      Boolean @default(true)
  excludeLPTokens     Boolean @default(true)
  
  // Manual overrides (comma-separated mints)
  manualRunners       String? // Force these as runners
  manualExcluded      String? // Force exclude these
}
